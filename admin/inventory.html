<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AAGAM Admin - Inventory Management</title>
    <link rel="stylesheet" href="css/admin.css">
    <style>
        .inventory-container { padding: 20px; }
        .inventory-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .inventory-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .stat-value { font-size: 24px; font-weight: bold; color: #3498db; }
        .stat-label { color: #666; margin-top: 5px; }
        .inventory-table { background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .inventory-table table { width: 100%; border-collapse: collapse; }
        .inventory-table th, .inventory-table td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
        .inventory-table th { background: #f8f9fa; font-weight: 600; }
        .stock-level { padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 500; }
        .stock-high { background: #d4edda; color: #155724; }
        .stock-medium { background: #fff3cd; color: #856404; }
        .stock-low { background: #f8d7da; color: #721c24; }
        .stock-out { background: #e2e3e5; color: #383d41; }
        .btn { padding: 6px 12px; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; }
        .btn-primary { background: #3498db; color: white; }
        .btn-secondary { background: #6c757d; color: white; }
        .btn-warning { background: #ffc107; color: #212529; }
        .btn-success { background: #28a745; color: white; }
        .filters { display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap; }
        .filter-group { display: flex; flex-direction: column; }
        .filter-group label { font-size: 14px; font-weight: 500; margin-bottom: 5px; }
        .filter-group select, .filter-group input { padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        .inventory-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; }
        .inventory-modal-content { background: white; margin: 5% auto; padding: 20px; border-radius: 8px; width: 90%; max-width: 500px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 500; }
        .form-group input, .form-group select { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        .bulk-actions { display: flex; gap: 10px; margin-bottom: 20px; }
        .alert-section { background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; padding: 15px; margin-bottom: 20px; }
        .alert-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .connection-status { position: fixed; top: 10px; right: 10px; padding: 5px 10px; border-radius: 20px; font-size: 12px; z-index: 1000; }
        .connection-status.connected { background: #d4edda; color: #155724; }
        .connection-status.disconnected { background: #f8d7da; color: #721c24; }
        .real-time-indicator { display: inline-block; width: 8px; height: 8px; border-radius: 50%; background: #28a745; margin-left: 5px; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        .notification-toast { position: fixed; top: 20px; right: 20px; background: #d4edda; color: #155724; padding: 12px 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.15); z-index: 1000; animation: slideIn 0.3s ease; }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2>AAGAM Admin</h2>
        </div>
        <nav class="sidebar-nav">
            <a href="index.html" class="nav-item">
                <span class="icon">üìä</span> Dashboard
            </a>
            <a href="products.html" class="nav-item">
                <span class="icon">üì¶</span> Products
            </a>
            <a href="orders.html" class="nav-item">
                <span class="icon">üìã</span> Orders
            </a>
            <a href="inventory.html" class="nav-item active">
                <span class="icon">üìà</span> Inventory
            </a>
            <a href="#" class="nav-item">
                <span class="icon">üë•</span> Users
            </a>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Topbar -->
        <div class="topbar">
            <div class="topbar-left">
                <button class="menu-toggle" id="menuToggle">‚ò∞</button>
                <h1>Inventory Management <span class="real-time-indicator" id="realTimeIndicator"></span></h1>
            </div>
            <div class="topbar-right">
                <div class="notifications">
                    <span class="icon">üîî</span>
                    <span class="badge" id="notificationBadge">0</span>
                </div>
                <div class="user-profile">
                    <span class="icon">üë§</span>
                    <span>Admin</span>
                </div>
            </div>
        </div>

        <!-- Inventory Content -->
        <div class="inventory-container">
            <!-- Low Stock Alerts -->
            <div class="alert-section" id="lowStockAlerts">
                <h4>‚ö†Ô∏è Low Stock Alerts</h4>
                <div id="alertsList">
                    <!-- Low stock alerts will be loaded here -->
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="inventory-stats">
                <div class="stat-card">
                    <div class="stat-value" id="totalItems">0</div>
                    <div class="stat-label">Total Items</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="inStockItems">0</div>
                    <div class="stat-label">In Stock</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="lowStockItems">0</div>
                    <div class="stat-label">Low Stock</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="outOfStockItems">0</div>
                    <div class="stat-label">Out of Stock</div>
                </div>
            </div>

            <!-- Bulk Actions -->
            <div class="bulk-actions">
                <button class="btn btn-primary" onclick="openInventoryModal()">Add Stock</button>
                <button class="btn btn-warning" onclick="exportInventory()">Export CSV</button>
                <button class="btn btn-success" onclick="generateReport()">Generate Report</button>
            </div>

            <!-- Filters -->
            <div class="filters">
                <div class="filter-group">
                    <label for="categoryFilter">Category</label>
                    <select id="categoryFilter">
                        <option value="">All Categories</option>
                        <option value="groceries">Groceries</option>
                        <option value="vegetables">Vegetables</option>
                        <option value="fruits">Fruits</option>
                        <option value="dairy">Dairy</option>
                        <option value="beverages">Beverages</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="stockFilter">Stock Level</label>
                    <select id="stockFilter">
                        <option value="">All Levels</option>
                        <option value="out">Out of Stock</option>
                        <option value="low">Low Stock</option>
                        <option value="medium">Medium Stock</option>
                        <option value="high">High Stock</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="searchFilter">Search</label>
                    <input type="text" id="searchFilter" placeholder="Product name">
                </div>
            </div>

            <!-- Inventory Table -->
            <div class="inventory-table">
                <table>
                    <thead>
                        <tr>
                            <th>Product</th>
                            <th>Category</th>
                            <th>Current Stock</th>
                            <th>Min Stock</th>
                            <th>Stock Level</th>
                            <th>Last Updated</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="inventoryTableBody">
                        <!-- Inventory items will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Inventory Modal -->
    <div class="inventory-modal" id="inventoryModal">
        <div class="inventory-modal-content">
            <h3 id="inventoryModalTitle">Update Stock</h3>
            <form id="inventoryForm">
                <div class="form-group">
                    <label for="productSelect">Product</label>
                    <select id="productSelect" required>
                        <option value="">Select Product</option>
                        <!-- Products will be loaded here -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="stockAdjustment">Stock Adjustment</label>
                    <input type="number" id="stockAdjustment" placeholder="Enter quantity to add/subtract" required>
                </div>
                <div class="form-group">
                    <label for="adjustmentReason">Reason</label>
                    <select id="adjustmentReason" required>
                        <option value="">Select Reason</option>
                        <option value="restock">Restock</option>
                        <option value="damaged">Damaged/Expired</option>
                        <option value="returned">Customer Return</option>
                        <option value="correction">Stock Correction</option>
                        <option value="transfer">Warehouse Transfer</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="adjustmentNotes">Notes (Optional)</label>
                    <input type="text" id="adjustmentNotes" placeholder="Additional notes">
                </div>
                <div style="text-align: right; margin-top: 20px;">
                    <button type="button" class="btn btn-secondary" onclick="closeInventoryModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Update Stock</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Connection Status -->
    <div class="connection-status" id="connectionStatus">Connecting...</div>

    <script>
        // Real-time WebSocket connection for admin inventory
        class AdminInventoryApp {
            constructor() {
                this.ws = null;
                this.inventory = [];
                this.filteredInventory = [];
                this.connectionStatus = 'disconnected';
                this.lowStockThreshold = 5;
                this.init();
            }

            init() {
                this.connectWebSocket();
                this.setupEventListeners();
                this.loadInventory();
                this.updateStats();
                this.checkLowStockAlerts();
            }

            // WebSocket connection
            connectWebSocket() {
                const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
                const wsUrl = `${protocol}//${window.location.host}`;

                try {
                    this.ws = new WebSocket(wsUrl);
                    this.updateConnectionStatus('connecting');

                    this.ws.onopen = () => {
                        this.updateConnectionStatus('connected');
                        this.authenticate();
                        this.showNotification('Connected to real-time server', 'success');
                    };

                    this.ws.onmessage = (event) => {
                        const data = JSON.parse(event.data);
                        this.handleWebSocketMessage(data);
                    };

                    this.ws.onclose = () => {
                        this.updateConnectionStatus('disconnected');
                        this.showNotification('Disconnected from server', 'warning');
                        // Auto reconnect
                        setTimeout(() => this.connectWebSocket(), 5000);
                    };

                    this.ws.onerror = () => {
                        this.updateConnectionStatus('error');
                    };
                } catch (error) {
                    console.error('WebSocket connection failed:', error);
                    this.updateConnectionStatus('error');
                }
            }

            // Authenticate as admin
            authenticate() {
                if (this.ws && this.ws.readyState === WebSocket.OPEN) {
                    this.ws.send(JSON.stringify({
                        type: 'admin_auth',
                        token: localStorage.getItem('admin_token') || 'admin_session'
                    }));
                }
            }

            // Handle WebSocket messages
            handleWebSocketMessage(data) {
                console.log('Admin inventory received:', data.type);

                switch (data.type) {
                    case 'inventory_updated':
                        this.onInventoryUpdated(data.inventory);
                        break;
                    case 'stock_alert':
                        this.onStockAlert(data.alert);
                        break;
                    case 'product_stock_changed':
                        this.onProductStockChanged(data);
                        break;
                    case 'bulk_inventory_update':
                        this.onBulkInventoryUpdate(data);
                        break;
                }
            }

            // Real-time inventory updates
            onInventoryUpdated(inventory) {
                this.inventory = inventory;
                this.applyFilters();
                this.updateStats();
                this.checkLowStockAlerts();
                this.showNotification('Inventory updated in real-time', 'info');
            }

            onStockAlert(alert) {
                this.showNotification(`Stock alert: ${alert.productName} - ${alert.currentStock} remaining`, 'warning');
                this.checkLowStockAlerts();
                this.updateNotificationBadge();
            }

            onProductStockChanged(data) {
                const item = this.inventory.find(i => i.id === data.productId);
                if (item) {
                    item.stock = data.newStock;
                    item.lastUpdated = new Date().toISOString();
                    this.applyFilters();
                    this.updateStats();
                    this.checkLowStockAlerts();
                    this.showNotification(`${item.name} stock updated to ${data.newStock}`, 'info');
                }
            }

            onBulkInventoryUpdate(data) {
                data.updates.forEach(update => {
                    const item = this.inventory.find(i => i.id === update.productId);
                    if (item) {
                        item.stock = update.newStock;
                        item.lastUpdated = new Date().toISOString();
                    }
                });
                this.applyFilters();
                this.updateStats();
                this.checkLowStockAlerts();
                this.showNotification('Bulk inventory update completed', 'success');
            }

            // Load inventory from API
            async loadInventory() {
                try {
                    const response = await fetch('/api/inventory');
                    const data = await response.json();
                    this.inventory = data.inventory || [];
                    this.applyFilters();
                    this.updateStats();
                    this.checkLowStockAlerts();
                    this.loadProductOptions();
                } catch (error) {
                    console.error('Error loading inventory:', error);
                    // Fallback to mock data
                    this.inventory = this.generateMockInventory();
                    this.applyFilters();
                    this.updateStats();
                    this.checkLowStockAlerts();
                    this.loadProductOptions();
                }
            }

            // Generate mock inventory for demo
            generateMockInventory() {
                const products = [
                    { id: 1, name: 'Aashirvaad Atta', category: 'groceries' },
                    { id: 2, name: 'Fresh Milk', category: 'dairy' },
                    { id: 3, name: 'Fresh Vegetables', category: 'vegetables' },
                    { id: 4, name: 'Rice Pack', category: 'groceries' },
                    { id: 5, name: 'Fruit Basket', category: 'fruits' },
                    { id: 6, name: 'Soft Drinks', category: 'beverages' }
                ];

                return products.map(product => ({
                    id: product.id,
                    name: product.name,
                    category: product.category,
                    stock: Math.floor(Math.random() * 50),
                    minStock: Math.floor(Math.random() * 10) + 5,
                    lastUpdated: new Date(Date.now() - Math.random() * 7 * 24 * 60 * 60 * 1000).toISOString()
                }));
            }

            // Render inventory table
            renderInventoryTable() {
                const tbody = document.getElementById('inventoryTableBody');
                tbody.innerHTML = '';

                this.filteredInventory.forEach(item => {
                    const row = document.createElement('tr');
                    const stockLevel = this.getStockLevel(item.stock, item.minStock);
                    const lastUpdated = new Date(item.lastUpdated).toLocaleDateString();

                    row.innerHTML = `
                        <td>${item.name}</td>
                        <td>${item.category.charAt(0).toUpperCase() + item.category.slice(1)}</td>
                        <td>${item.stock}</td>
                        <td>${item.minStock}</td>
                        <td><span class="stock-level stock-${stockLevel.level}">${stockLevel.text}</span></td>
                        <td>${lastUpdated}</td>
                        <td>
                            <button class="btn btn-primary" onclick="adminInventoryApp.adjustStock(${item.id}, 1)">+1</button>
                            <button class="btn btn-primary" onclick="adminInventoryApp.adjustStock(${item.id}, -1)">-1</button>
                            <button class="btn btn-secondary" onclick="adminInventoryApp.viewStockHistory(${item.id})">History</button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            }

            // Get stock level classification
            getStockLevel(currentStock, minStock) {
                if (currentStock === 0) return { level: 'out', text: 'Out of Stock' };
                if (currentStock <= minStock) return { level: 'low', text: 'Low Stock' };
                if (currentStock <= minStock * 2) return { level: 'medium', text: 'Medium Stock' };
                return { level: 'high', text: 'High Stock' };
            }

            // Apply filters
            applyFilters() {
                const categoryFilter = document.getElementById('categoryFilter').value;
                const stockFilter = document.getElementById('stockFilter').value;
                const searchFilter = document.getElementById('searchFilter').value.toLowerCase();

                this.filteredInventory = this.inventory.filter(item => {
                    if (categoryFilter && item.category !== categoryFilter) return false;
                    if (stockFilter) {
                        const stockLevel = this.getStockLevel(item.stock, item.minStock);
                        if (stockLevel.level !== stockFilter) return false;
                    }
                    if (searchFilter && !item.name.toLowerCase().includes(searchFilter)) return false;
                    return true;
                });

                this.renderInventoryTable();
            }

            // Update statistics
            updateStats() {
                const totalItems = this.inventory.length;
                const inStockItems = this.inventory.filter(i => i.stock > 0).length;
                const lowStockItems = this.inventory.filter(i => i.stock > 0 && i.stock <= i.minStock).length;
                const outOfStockItems = this.inventory.filter(i => i.stock === 0).length;

                document.getElementById('totalItems').textContent = totalItems;
                document.getElementById('inStockItems').textContent = inStockItems;
                document.getElementById('lowStockItems').textContent = lowStockItems;
                document.getElementById('outOfStockItems').textContent = outOfStockItems;
            }

            // Check low stock alerts
            checkLowStockAlerts() {
                const lowStockItems = this.inventory.filter(i => i.stock <= i.minStock && i.stock > 0);
                const alertsList = document.getElementById('alertsList');
                const alertsSection = document.getElementById('lowStockAlerts');

                if (lowStockItems.length > 0) {
                    alertsList.innerHTML = '';
                    lowStockItems.forEach(item => {
                        const alertDiv = document.createElement('div');
                        alertDiv.className = 'alert-item';
                        alertDiv.innerHTML = `
                            <span>${item.name} - Only ${item.stock} remaining</span>
                            <button class="btn btn-primary" onclick="adminInventoryApp.adjustStock(${item.id}, ${item.minStock * 2 - item.stock})">Restock</button>
                        `;
                        alertsList.appendChild(alertDiv);
                    });
                    alertsSection.style.display = 'block';
                } else {
                    alertsSection.style.display = 'none';
                }

                this.updateNotificationBadge();
            }

            // Update connection status
            updateConnectionStatus(status) {
                this.connectionStatus = status;
                const statusEl = document.getElementById('connectionStatus');
                const indicator = document.getElementById('realTimeIndicator');

                switch (status) {
                    case 'connected':
                        statusEl.textContent = 'üü¢ Connected';
                        statusEl.className = 'connection-status connected';
                        indicator.style.display = 'inline-block';
                        break;
                    case 'connecting':
                        statusEl.textContent = 'üü° Connecting...';
                        statusEl.className = 'connection-status';
                        indicator.style.display = 'none';
                        break;
                    case 'disconnected':
                        statusEl.textContent = 'üî¥ Disconnected';
                        statusEl.className = 'connection-status disconnected';
                        indicator.style.display = 'none';
                        break;
                    case 'error':
                        statusEl.textContent = '‚ùå Connection Error';
                        statusEl.className = 'connection-status disconnected';
                        indicator.style.display = 'none';
                        break;
                }
            }

            // Show notifications
            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = 'notification-toast';
                notification.style.background = type === 'success' ? '#d4edda' : type === 'error' ? '#f8d7da' : type === 'warning' ? '#fff3cd' : '#d1ecf1';
                notification.style.color = type === 'success' ? '#155724' : type === 'error' ? '#721c24' : type === 'warning' ? '#856404' : '#0c5460';
                notification.textContent = message;

                document.body.appendChild(notification);

                setTimeout(() => {
                    notification.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => notification.remove(), 300);
                }, 3000);
            }

            // Update notification badge
            updateNotificationBadge() {
                const lowStockCount = this.inventory.filter(i => i.stock <= i.minStock && i.stock > 0).length;
                const badge = document.getElementById('notificationBadge');
                badge.textContent = lowStockCount;
                badge.style.display = lowStockCount > 0 ? 'inline-block' : 'none';
            }

            // Load product options for modal
            loadProductOptions() {
                const select = document.getElementById('productSelect');
                select.innerHTML = '<option value="">Select Product</option>';

                this.inventory.forEach(item => {
                    const option = document.createElement('option');
                    option.value = item.id;
                    option.textContent = `${item.name} (Current: ${item.stock})`;
                    select.appendChild(option);
                });
            }

            // Adjust stock quickly
            async adjustStock(productId, adjustment) {
                try {
                    const response = await fetch(`/api/inventory/${productId}/adjust`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            adjustment: adjustment,
                            reason: 'quick_adjust',
                            notes: `Quick adjustment by ${adjustment}`
                        })
                    });

                    if (response.ok) {
                        // Update local data
                        const item = this.inventory.find(i => i.id === productId);
                        if (item) {
                            item.stock = Math.max(0, item.stock + adjustment);
                            item.lastUpdated = new Date().toISOString();
                            this.applyFilters();
                            this.updateStats();
                            this.checkLowStockAlerts();
                        }

                        // Notify via WebSocket
                        if (this.ws && this.ws.readyState === WebSocket.OPEN) {
                            this.ws.send(JSON.stringify({
                                type: 'product_stock_changed',
                                productId: productId,
                                newStock: item.stock,
                                adjustment: adjustment
                            }));
                        }

                        this.showNotification(`Stock adjusted by ${adjustment}`, 'success');
                    } else {
                        throw new Error('Failed to adjust stock');
                    }
                } catch (error) {
                    console.error('Error adjusting stock:', error);
                    this.showNotification('Error adjusting stock', 'error');
                }
            }

            // View stock history
            viewStockHistory(productId) {
                const item = this.inventory.find(i => i.id === productId);
                if (item) {
                    this.showNotification(`Stock history for ${item.name} - Feature coming soon!`, 'info');
                }
            }

            // Open inventory modal
            openInventoryModal() {
                document.getElementById('inventoryModalTitle').textContent = 'Update Stock';
                document.getElementById('inventoryForm').reset();
                document.getElementById('inventoryModal').style.display = 'block';
            }

            // Close inventory modal
            closeInventoryModal() {
                document.getElementById('inventoryModal').style.display = 'none';
            }

            // Save inventory adjustment
            async saveInventoryAdjustment(formData) {
                try {
                    const productId = formData.get('productId');
                    const adjustment = parseInt(formData.get('adjustment'));
                    const reason = formData.get('reason');
                    const notes = formData.get('notes');

                    const response = await fetch(`/api/inventory/${productId}/adjust`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            adjustment: adjustment,
                            reason: reason,
                            notes: notes
                        })
                    });

                    if (response.ok) {
                        // Update local data
                        const item = this.inventory.find(i => i.id === productId);
                        if (item) {
                            item.stock = Math.max(0, item.stock + adjustment);
                            item.lastUpdated = new Date().toISOString();
                            this.applyFilters();
                            this.updateStats();
                            this.checkLowStockAlerts();
                            this.loadProductOptions();
                        }

                        // Notify via WebSocket
                        if (this.ws && this.ws.readyState === WebSocket.OPEN) {
                            this.ws.send(JSON.stringify({
                                type: 'product_stock_changed',
                                productId: productId,
                                newStock: item.stock,
                                adjustment: adjustment
                            }));
                        }

                        this.closeInventoryModal();
                        this.showNotification('Stock updated successfully!', 'success');
                    } else {
                        throw new Error('Failed to update stock');
                    }
                } catch (error) {
                    console.error('Error updating stock:', error);
                    this.showNotification('Error updating stock', 'error');
                }
            }

            // Export inventory
            exportInventory() {
                const csvContent = [
                    ['Product', 'Category', 'Stock', 'Min Stock', 'Last Updated'],
                    ...this.filteredInventory.map(item => [
                        item.name,
                        item.category,
                        item.stock,
                        item.minStock,
                        new Date(item.lastUpdated).toLocaleDateString()
                    ])
                ].map(row => row.join(',')).join('\n');

                const blob = new Blob([csvContent], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `inventory_${new Date().toISOString().split('T')[0]}.csv`;
                a.click();
                window.URL.revokeObjectURL(url);

                this.showNotification('Inventory exported successfully!', 'success');
            }

            // Generate report
            generateReport() {
                const report = {
                    totalItems: this.inventory.length,
                    inStockItems: this.inventory.filter(i => i.stock > 0).length,
                    lowStockItems: this.inventory.filter(i => i.stock > 0 && i.stock <= i.minStock).length,
                    outOfStockItems: this.inventory.filter(i => i.stock === 0).length,
                    generatedAt: new Date().toISOString()
                };

                console.log('Inventory Report:', report);
                this.showNotification('Inventory report generated! Check console for details.', 'success');
            }

            // Setup event listeners
            setupEventListeners() {
                // Menu toggle
                document.getElementById('menuToggle').addEventListener('click', () => {
                    document.getElementById('sidebar').classList.toggle('collapsed');
                });

                // Filters
                document.getElementById('categoryFilter').addEventListener('change', () => this.applyFilters());
                document.getElementById('stockFilter').addEventListener('change', () => this.applyFilters());
                document.getElementById('searchFilter').addEventListener('input', () => this.applyFilters());

                // Inventory form submission
                document.getElementById('inventoryForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    const formData = new FormData(e.target);
                    this.saveInventoryAdjustment(formData);
                });

                // Modal close
                document.getElementById('inventoryModal').addEventListener('click', (e) => {
                    if (e.target === document.getElementById('inventoryModal')) {
                        this.closeInventoryModal();
                    }
                });
            }
        }

        // Initialize the app
        const adminInventoryApp = new AdminInventoryApp();

        // Global functions for HTML onclick handlers
        function openInventoryModal() {
            adminInventoryApp.openInventoryModal();
        }

        function closeInventoryModal() {
            adminInventoryApp.closeInventoryModal();
        }

        function exportInventory() {
            adminInventoryApp.exportInventory();
        }

        function generateReport() {
            adminInventoryApp.generateReport();
        }

        // Add CSS animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
